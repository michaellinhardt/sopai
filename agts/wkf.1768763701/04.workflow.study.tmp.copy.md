# Workflow: Analyze-Review-Apply

## Purpose
Structured workflow for analyzing a problem, getting expert review, and applying fixes.

---

## Input
- **Initial Request:** [User's request describing what needs to be fixed/improved]
- **Target File(s):** [File(s) to analyze and modify]

---

## Workflow Steps

### Step 1: Initialize Workflow
1. Create workflow folder: `mkdir -p ./agts && mkdir "./agts/wkf.$(date +%s)/"`
2. Create `00.workflow.context.md` with:
   - Initial request
   - Purpose
   - Method
   - Acceptance criteria

### Step 2: Analyze
1. Read target file(s)
2. Identify gaps, issues, or missing elements
3. Write `01.analyse.md` containing:
   - Problem statement
   - Current state (with line references)
   - List of potential issues with:
     - What's wrong
     - Why it's a problem
     - How to fix it
   - Proposed solution
   - Summary table (gap, severity, fix)

### Step 3: Expert Review
1. Spawn AI Engineer sub-agent with:
   - `**Workflow folder:** /absolute/path/to/wkf.xxx/`
   - Task description
   - Context (target file content, analysis summary)
2. Sub-agent creates:
   - `02.ai-engineer.review.context.md` - Review of analysis (agree/disagree, additional insights)
   - `03.[target].proposed.md` - Full proposed revision

### Step 4: Discuss
1. Present summary of proposed changes to user
2. Highlight key decisions and rationale
3. Ask: "Ready to discuss or apply?"
4. Address any user feedback or questions

### Step 5: Apply
1. On user approval ("apply"), edit target file(s)
2. Update `00.workflow.context.md` with execution report:
   - Status: COMPLETED
   - Changes applied (with line numbers)
   - AGT files created
   - Project files edited

---

## File Naming Convention

| ID | File | Purpose |
|----|------|---------|
| 00 | `00.workflow.context.md` | Request, purpose, method, acceptance, execution report |
| 01 | `01.analyse.md` | Problem analysis |
| 02 | `02.ai-engineer.review.context.md` | Expert review |
| 03 | `03.[name].proposed.md` | Proposed revision |

---

## Example Usage

**Initial Request:**
> "Fix the authentication module - it's not validating tokens properly"

**Target File:** `src/auth/validator.js`

**Workflow Execution:**
1. Create `./agts/wkf.1768800000/`
2. Analyze `validator.js`, identify validation gaps
3. AI Engineer reviews, proposes fix
4. Discuss with user
5. Apply approved changes

---

## Notes
- Sub-agents MUST receive explicit workflow folder path
- All workflow artifacts go to `./agts/wkf.xxx/`
- Use MUST/NEVER language for constraints
- Keep analysis structured with tables for quick review
