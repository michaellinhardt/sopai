# CLAUDE.md

## Role Detection

**Check your prompt for:** `**Workflow folder:**` followed by a path.

- **Path present** -> You are a **SUB-AGENT**. Follow Sub-Agent Rules.
- **No path** -> You are the **ORCHESTRATOR**. Follow Orchestrator Rules.

---

## Orchestrator Rules

**Responsibilities:**
- Create workflow folder: `mkdir -p ./agts && mkdir "./agts/wkf.$(date +%s)/"`
- Create `00.workflow.context.md` with: request, purpose, method, acceptance criteria
- Spawn sub-agents WITH explicit `**Workflow folder:** /absolute/path/`
- Log workflow state after each task
- Write execution report on completion

**Core Directives:**
- Optimize context window: avoid unnecessary reads
- Read files partially when classifying
- Create tasks for all operations

---

## Sub-Agent Rules

**CONSTRAINTS (MANDATORY):**
- NEVER create `./agts/` or `wkf.xxx/` folders
- NEVER run `mkdir` for workflow folders
- ONLY write to the provided workflow path
- If no path received: STOP and report error

**Behavior:**
- Use the exact path from `**Workflow folder:**` in your prompt
- Save outputs to that folder using naming convention
- Do not init workflow files (orchestrator handles this)

---

## Shared Rules

### Naming Convention

**Format:** `[2-digit-ID].[name].[type].md`
- No spaces/special chars, use dots
- Concise names

**Examples:** `03.sota.persona.context.md`, `12.references.log.md`

**ID Rules:** Incremental per file. Parallel files share same ID.

### File Writing Rules

**CONSTRAINTS (MANDATORY):**

1. **No path specified in request:**
   - MUST write to `./agts/wkf.xxx/`
   - MUST use naming convention

2. **Path specified in request:**
   - MUST write to the specified path
   - MUST ALSO copy to `./agts/wkf.xxx/` with `.copy` as type
   - Copy naming: `[ID].[original-filename].copy.md`
   - Example: request says `/project/.claude/config.md` -> write there AND write `./agts/wkf.xxx/05.config.copy.md`

3. **Exception:** If specified path is already inside `./agts/wkf.xxx/`, do NOT create duplicate copy.

### File Locations

- Non-project files (memory, state, reports): `./agts/wkf.xxx/`
- Project files: specified path (with copy to wkf folder)
- Claude Code files (skills, agents): `.claude/` (local or home)

### Workflow Syntax

- H2 headers: create task
- H3 headers: create task with `sub:` prefix
- Sub-agent: create task with `agt:` prefix

---

## Orchestrator Startup

Create `./agts` if needed, init workflow files, spawn sub-agents with paths, execute request.

**Sub-agents: This section does not apply to you.**
