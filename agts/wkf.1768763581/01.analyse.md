# Analysis: File Writing Rules Missing in CLAUDE.md

## Problem Statement
When a request asks to write files without specifying a path, agents should default to agt folder. When a path IS specified, file goes there AND a copy goes to agt folder with `.copy.md` suffix.

---

## Current State (L55-59)

```markdown
### File Locations
- Non-project files (memory, state, reports): `./agts/wkf.xxx/`
- Project files: remain in project location
- Claude Code files (skills, agents): `.claude/` (local or home)
```

**Gaps:**
1. No explicit default behavior when path is missing
2. No dual-write rule for explicit paths
3. No copy naming convention

---

## Potential Reasons for Non-Compliance

### 1. No Default Rule
**Current:** Mentions where files *should* go, not what to do when path is absent.
**Problem:** Agents interpret ambiguously - may ask user or pick arbitrary location.
**Fix:** Add explicit "No path = agt folder" rule.

### 2. No Dual-Write Mechanism
**Current:** Nothing about copying files to agt when written elsewhere.
**Problem:** Files written to project locations aren't tracked in workflow.
**Fix:** Add rule: "Path specified = write there + copy to agt with `.copy.md`"

### 3. No Copy Naming Convention
**Current:** Only covers primary file naming (`[ID].[name].[type].md`).
**Problem:** No convention for copies.
**Fix:** Define `.copy.md` suffix: `original.md` → `[ID].original.copy.md`

### 4. Rule Not in Shared Section
**Current:** File Locations is in Shared Rules but lacks enforcement language.
**Problem:** Reads as guidance, not requirement.
**Fix:** Add **CONSTRAINTS** block like Sub-Agent Rules.

---

## Proposed Solution

Add new section under Shared Rules:

```markdown
### File Writing Rules

**Default (no path specified):**
- Write to `./agts/wkf.xxx/` using naming convention

**Explicit path specified:**
- Write to specified path
- ALSO copy to `./agts/wkf.xxx/` with `.copy` before `.md`
- Example: `/project/config.md` → also write `./agts/wkf.xxx/[ID].config.copy.md`

**Rationale:** All workflow artifacts tracked in agt folder for audit/replay.
```

---

## Summary

| Gap | Severity | Fix |
|-----|----------|-----|
| No default rule | HIGH | Add explicit "no path = agt" |
| No dual-write | HIGH | Add copy rule |
| No copy naming | MEDIUM | Define `.copy.md` convention |
| Soft language | LOW | Use MUST/ALWAYS |
